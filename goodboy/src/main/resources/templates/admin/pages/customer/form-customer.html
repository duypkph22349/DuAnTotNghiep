<!DOCTYPE html>
<html layout:decorate="~{admin/layout}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body class="container">
<section layout:fragment="content">
<div class="container">
    <a href="/admin/customer/view-add">New</a>
    <h1 style="text-align: center">LIST CUSTOMER</h1>
    <table class="table table-active">
        <tr>
            <th>#</th>
            <th>Code</th>
            <th>Name</th>
            <th>Gender</th>
            <th>Birth_Date</th>
            <th>Phone</th>
            <th>FullAddress</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
        <tr th:each="customer, i :${list}">
            <td th:text="${i.index+1}"></td>
            <td th:text="${customer.code}"></td>
            <td th:text="${customer.name}"></td>
            <td th:text="${customer.gender}==false?'Male':'Female'"></td>
            <td th:text="${customer.birth_date}"></td>
            <td th:text="${customer.phone}"></td>
            <td th:text="${customer.fulladdress}"></td>
            <td th:text="${customer.status}==0?'Active':'No longer active'"></td>
            <td>
                <a th:href="@{'/admin/customer/detail/' + ${customer.id}}" class="btn btn-primary">Detail</a>
                <a th:href="@{'/admin/customer/delete/' + ${customer.id}}" class="btn btn-danger">Delete</a>
            </td>
        </tr>
    </table>
    <ul class="pagination">
        <th:block th:each="i: ${#numbers.sequence(1, totalPage)}">
            <li class="page-item">
                <a class="page-link" th:href="@{'/admin/customer/get-all?pageNum=' + ${i}}" th:text=${i}></a>
            </li>
        </th:block>
    </ul>
</div>
</section>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"
        integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    // 1. what is API
    // 2. How do I call API
    // 3. Explain code
    const host = "https://provinces.open-api.vn/api/";
    var callAPI = (api) => {
        return axios.get(api)
            .then((response) => {
                renderData(response.data, "province");
            });
    }
    callAPI('https://provinces.open-api.vn/api/?depth=1');
    var callApiDistrict = (api) => {
        return axios.get(api)
            .then((response) => {
                renderData(response.data.districts, "district");
            });
    }
    var callApiWard = (api) => {
        return axios.get(api)
            .then((response) => {
                renderData(response.data.wards, "ward");
            });
    }

    // var renderData = (array, select) => {
    //     let row = ' <option disable value="">chọn</option>';
    //     array.forEach(element => {
    //         row += `<option value="${element.code}">${element.name}</option>`
    //     });
    //     document.querySelector("#" + select).innerHTML = row
    // }

    $("#province").change(() => {
        callApiDistrict(host + "p/" + $("#province").val() + "?depth=2");
        printResult();
    });
    $("#district").change(() => {
        callApiWard(host + "d/" + $("#district").val() + "?depth=2");
        printResult();
    });
    $("#ward").change(() => {
        printResult();
    })

    var printResult = () => {
        if ($("#district").val() != "" && $("#province").val() != "" &&
            $("#ward").val() != "") {
            let result = $("#province option:selected").text() +
                " | " + $("#district option:selected").text() + " | " +
                $("#ward option:selected").text();
            $("#result").text(result)
        }

    }
    var renderData = (array, select) => {
        let row = ' <option disable value="">chọn</option>';
        array.forEach(element => {
            row += `<option value="${element.code}" data-name="${element.name}">${element.name}</option>`
        });
        document.querySelector("#" + select).innerHTML = row
    }
    var getCodeToName = (selectId, code) => {
        var select = document.getElementById(selectId);
        var options = select.getElementsByTagName("option");
        for (var i = 0; i < options.length; i++) {
            if (options[i].value === code) {
                return options[i].getAttribute("data-name");
            }
        }
        return "";
    }
    var selectedName = getCodeToName("province", $("#province").val());
    console.log(selectedName);
</script>
</body>
</html>
